# Проект: Анализатор логов

## Описание проекта

Данный проект реализует парсер логов с возможностью фильтрации, анализа и форматирования. Поддерживаются как локальные файлы логов, так и URL-адреса. Программа позволяет задавать фильтры, выбирать формат вывода и анализировать данные.

---

## Функциональность

- **Чтение логов**:
  - Логи можно загружать как из локальных файлов, так и из URL.
- **Фильтрация**:
  - Поддерживается фильтрация по заданному полю и значению.
  - Если указанное поле не найдено в логе, фильтр не применяется.
- **Форматирование**:
  - Поддерживаются форматы вывода: `adoc` и `markdown`.
- **Командная строка**:
  - Программа поддерживает управление с помощью аргументов командной строки.
 
- **Фильтрация логов**:
  - Поддерживаются фильтры по следующим полям:
    - `remoteAddress` — IP-адрес клиента.
    - `remoteUser` — Имя пользователя.
    - `timeZoned` — Время запроса (в формате ZonedDateTime).
    - `request` — Запрос (метод, URL, версия HTTP).
    - `status` — Код ответа HTTP.
    - `bodyBytesSent` — Размер ответа.
    - `httpReferer` — Реферер (если указан).
    - `httpUserAgent` — User-Agent запроса.
  - Если указанное поле не найдено, фильтр игнорируется.

---

## Примеры аргументов командной строки

Программа принимает следующие аргументы:

| Аргумент              | Описание                                                                                           |
|-----------------------|---------------------------------------------------------------------------------------------------|
| `--path`             | Указывает путь к логам (может быть локальным или URL).                                            |
| `--from`             | Начальная дата фильтрации (например, `2015-01-01`).                                              |
| `--to`               | Конечная дата фильтрации (например, `2015-12-31`).                                               |
| `--filter-field`     | Поле для фильтрации (например, `status`).                                                        |
| `--filter-value`     | Значение для фильтрации (например, `200`).                                                       |
| `--format`           | Формат вывода (например, `markdown`).     

### Пример 1
```bash
--path **/sample* --to 2015-05-19 --filter-field status --filter-value 20 --format markdown
```
**Результат**: Логи с указанным статусом `20` не найдены, так как в логах, соответствующих пути `**/sample*`, нет записей с этим статусом.

### Пример 2
```bash
--path https://raw.githubusercontent.com/elastic/examples/master/Common%20Data%20Formats/nginx_logs/nginx_logs --to 2015-05-19 analyzer --filter-field request --filter-value "status"  --format markdown
```
**Результат**: Вернутся все логи, так как дата всех логов меньше, чем указанная в секции to.

### Пример 3
```bash
--path **/sample* --from 2014-05-19 --format markdown
```
**Результат**: Вернутся записи из всех файлов проекта, в названии которых содержится sample а так же дата которых не меньше 2014-05-19.

## Основные классы и их функциональность

### 1. **LogAnalyzer**
Класс, отвечающий за обработку логов. Основные функции включают:
- Загрузка логов из заданного пути (локальный или удаленный).
- Фильтрация по дате, полю и значению.
- Форматирование отчета в различных форматах (Markdown, AsciiDoc).
- Использует утилиты и другие классы для выполнения обработки и форматирования.

**Ключевые методы:**
- `analyze()` — основной метод анализа логов.
- `getFormatOrDefault(String format)` — определяет формат вывода или использует значение по умолчанию.

**Зависимости:**
- `LogArgumentsParser` — парсит параметры командной строки.
- `LogParser` — загружает логи.
- `LogFilterUtil` — выполняет фильтрацию.
- `OutputHandler` — вывод результатов.
- Форматтеры (`MarkdownFormatter`, `AsciiDocFormatter`) — форматируют отчет.

---

### 2. **TotalLogInfo**
Класс для сбора и обработки статистики по логам.

**Функциональность:**
- Подсчет общего количества запросов.
- Вычисление среднего размера ответа.
- Сбор информации о частоте использования HTTP-методов, кодов ответа, ресурсов.
- Подсчет уникальных IP-адресов.
- Вычисление 95-го перцентиля размеров ответа.

**Ключевые методы:**
- `addLogRecord(LogRecord logRecord)` — добавляет информацию из записи лога.
- `getAverageBytesSent()` — возвращает средний размер ответа.
- `get95thPercentile()` — вычисляет 95-й перцентиль.
- `getMostFrequentResources()` — возвращает наиболее частые ресурсы.
- `getUniqueIpCount()` — возвращает количество уникальных IP-адресов.

---

### 3. **MarkdownFormatter**
Форматтер для генерации отчета в формате **Markdown**.

**Функциональность:**
- Форматирование заголовков, таблиц и строк.
- Преобразование данных в удобный для чтения Markdown-формат.

**Ключевые методы:**
- `formatHeader(String header)` — форматирует заголовок.
- `formatTableStart(String tableHeader)` — создает заголовок таблицы и линию выравнивания.
- `formatTableRow(String... columns)` — добавляет строку таблицы.
- `formatTableEnd()` — завершает таблицу.

---

### 4. **AsciiDocFormatter**
Форматтер для генерации отчета в формате **AsciiDoc**.

**Функциональность:**
- Форматирование заголовков, таблиц и строк в стиле AsciiDoc.

**Ключевые методы:**
- `formatHeader(String header)` — форматирует заголовок.
- `formatTableStart(String tableHeader)` — создает заголовок таблицы.
- `formatTableRow(String... columns)` — добавляет строку таблицы.
- `formatTableEnd()` — завершает таблицу.

---

### 5. **LogRecord**
Запись лога.

**Функциональность:**
- Запись лога, содержащая информацию о запросе клиента.

**Поля:**
- `remoteAddress` — IP-адрес клиента
- `remoteUser` — Имя пользователя
- `timeZoned` — Время запроса (с учетом временной зоны)
- `request` — Запрос (метод, URL, версия HTTP)
- `status` — Код ответа
- `bodyBytesSent` — Размер ответа
- `httpReferer` — Реферер (если имеется)
- `httpUserAgent` — User-Agent клиента

---

### Утилиты и вспомогательные классы

#### 1. **LogArgumentsParser**
- Парсит параметры командной строки, такие как путь к логам, временные границы, фильтры и формат вывода.

#### 2. **LogParser**
- Загружает лог-файлы и преобразует их в объекты `LogRecord`.

#### 3. **LogFilterUtil**
- Утилита для фильтрации логов по дате, полю или значению.

#### 4. **OutputHandler**
- Отвечает за вывод данных в поток `PrintStream`.

#### 5. **FileNameUtil**
- Определяет формат файла для вывода (Markdown или AsciiDoc).

---
